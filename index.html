<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>promise-android-tools</title><meta name="description" content="Documentation for promise-android-tools"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script><script async src="assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">promise-android-tools</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>promise-android-tools</h1></div><div class="tsd-panel tsd-typography"><p><img src="https://github.com/ubports/promise-android-tools/workflows/Continuous%20Integration/badge.svg" alt="Continuous Integration"> <a href="https://www.npmjs.com/package/promise-android-tools"><img src="https://img.shields.io/npm/v/promise-android-tools" alt="npm"></a> <a href="https://codecov.io/gh/ubports/promise-android-tools/"><img src="https://codecov.io/gh/ubports/promise-android-tools/branch/master/graph/badge.svg?token=cEneFUUbgt" alt="codecov"></a></p>
<h1 id="promise-android-tools" class="tsd-anchor-link">promise-android-tools<a href="#promise-android-tools" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>A wrapper for Adb, Fastboot, and Heimall written in modern asynchronous TypeScript that provides convenient promises for interacting with Android and Ubuntu Touch devices. The package was originally developed for the <a href="https://devices.ubuntu-touch.io/installer/">UBports Installer</a> but has since been expanded to cover all APIs of the included tools.</p>
<h2 id="usage" class="tsd-anchor-link">Usage<a href="#usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Install the package by running <code>npm i promise-android-tools</code>.</p>
<h3 id="quick-start-example" class="tsd-anchor-link">Quick-start example<a href="#quick-start-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The default settings should cover most usecases.</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">DeviceTools</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;promise-android-tools&quot;</span><span class="hl-1">;</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">dt</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">DeviceTools</span><span class="hl-1">();</span><br/><br/><span class="hl-2">dt</span><span class="hl-1">.</span><span class="hl-6">wait</span><span class="hl-1">() </span><span class="hl-7">// wait for any device</span><br/><span class="hl-1">  .</span><span class="hl-6">then</span><span class="hl-1">(</span><span class="hl-2">state</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-2">dt</span><br/><span class="hl-1">      .</span><span class="hl-6">getDeviceName</span><span class="hl-1">()</span><br/><span class="hl-1">      .</span><span class="hl-6">then</span><span class="hl-1">(</span><span class="hl-2">name</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">`detected </span><span class="hl-4">${</span><span class="hl-2">name</span><span class="hl-4">}</span><span class="hl-3"> in </span><span class="hl-4">${</span><span class="hl-2">state</span><span class="hl-4">}</span><span class="hl-3"> state`</span><span class="hl-1">))</span><br/><span class="hl-1">  );</span>
</code><button type="button">Copy</button></pre>

<h3 id="config-env-vars" class="tsd-anchor-link">Config, Env vars<a href="#config-env-vars" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Global command-line flags for tools are configurable on the <code>&lt;tool&gt;.config</code> property and described using an <code>ArgsModel</code>. The <code>&lt;tool&gt;._withConfig()</code> function allows overriding options temporarily. Additionally, <code>&lt;tool&gt;.__&lt;option&gt;()</code> helper functions are provided for all options.</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Adb</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;promise-android-tools&quot;</span><span class="hl-1">;</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">adb</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Adb</span><span class="hl-1">();</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-2">adb</span><span class="hl-1">.</span><span class="hl-2">config</span><span class="hl-1">.</span><span class="hl-2">serialno</span><span class="hl-1">, </span><span class="hl-7">// null</span><br/><span class="hl-1">  </span><span class="hl-2">adb</span><span class="hl-1">.</span><span class="hl-6">_withConfig</span><span class="hl-1">({ </span><span class="hl-2">serialno:</span><span class="hl-1"> </span><span class="hl-3">&quot;1337&quot;</span><span class="hl-1"> }).</span><span class="hl-2">config</span><span class="hl-1">.</span><span class="hl-2">serialno</span><span class="hl-1">, </span><span class="hl-7">// &quot;1337&quot;</span><br/><span class="hl-1">  </span><span class="hl-2">adb</span><span class="hl-1">.</span><span class="hl-6">__serialno</span><span class="hl-1">(</span><span class="hl-3">&quot;1337&quot;</span><span class="hl-1">).</span><span class="hl-2">config</span><span class="hl-1">.</span><span class="hl-2">serialno</span><span class="hl-1"> </span><span class="hl-7">// &quot;1337&quot;</span><br/><span class="hl-1">);</span><br/><span class="hl-2">adb</span><span class="hl-1">.</span><span class="hl-6">hasAccess</span><span class="hl-1">(); </span><span class="hl-7">// will run command `adb devices`</span><br/><span class="hl-2">adb</span><span class="hl-1">.</span><span class="hl-6">_withConfig</span><span class="hl-1">({ </span><span class="hl-2">serialno:</span><span class="hl-1"> </span><span class="hl-3">&quot;1337&quot;</span><span class="hl-1"> }).</span><span class="hl-6">hasAccess</span><span class="hl-1">(); </span><span class="hl-7">// will run command `adb -s 1337 devices`</span><br/><span class="hl-2">adb</span><span class="hl-1">.</span><span class="hl-6">__serialno</span><span class="hl-1">(</span><span class="hl-3">&quot;1337&quot;</span><span class="hl-1">).</span><span class="hl-6">hasAccess</span><span class="hl-1">(); </span><span class="hl-7">// will run command `adb -s 1337 devices`</span>
</code><button type="button">Copy</button></pre>

<h3 id="aborting-pending-promises" class="tsd-anchor-link">Aborting pending Promises<a href="#aborting-pending-promises" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Pending operations can be aborted using the standardized <a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal">AbortSignal</a>/<a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController">AbortController</a> APIs. Every tool implements its own <code>HierarchicalAbortController</code> for this purpose.</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Adb</span><span class="hl-1">, </span><span class="hl-2">HierarchicalAbortController</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;promise-android-tools&quot;</span><span class="hl-1">;</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">adb</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Adb</span><span class="hl-1">();</span><br/><span class="hl-2">adb</span><span class="hl-1">.</span><span class="hl-6">wait</span><span class="hl-1">(); </span><span class="hl-7">// will resolve once a device is detected or reject on error/abort</span><br/><span class="hl-2">adb</span><span class="hl-1">.</span><span class="hl-6">abort</span><span class="hl-1">(); </span><span class="hl-7">// will abort ALL pending promises from the instance</span>
</code><button type="button">Copy</button></pre>

<p>Additional <a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal">AbortSignal</a>s can be passed on the <code>signals</code> constructor parameter to listen to for aborting pending operations. The <code>&lt;tool&gt;._withSignals()</code> function returns a clone for the tool instance listening to additional abort signals.</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">Adb</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">Fastboot</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">HierarchicalAbortController</span><br/><span class="hl-1">} </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;promise-android-tools&quot;</span><span class="hl-1">;</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">controller</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">HierarchicalAbortController</span><span class="hl-1">();</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">adb</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Adb</span><span class="hl-1">({ </span><span class="hl-2">signals:</span><span class="hl-1"> [</span><span class="hl-2">controller</span><span class="hl-1">.</span><span class="hl-2">signal</span><span class="hl-1">] });</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">fastboot</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Fastboot</span><span class="hl-1">({ </span><span class="hl-2">signals:</span><span class="hl-1"> [</span><span class="hl-2">controller</span><span class="hl-1">.</span><span class="hl-2">signal</span><span class="hl-1">] });</span><br/><span class="hl-8">Promise</span><span class="hl-1">.</span><span class="hl-6">all</span><span class="hl-1">([</span><span class="hl-2">adb</span><span class="hl-1">.</span><span class="hl-6">wait</span><span class="hl-1">(), </span><span class="hl-2">fastboot</span><span class="hl-1">.</span><span class="hl-6">wait</span><span class="hl-1">()]);</span><br/><span class="hl-2">controller</span><span class="hl-1">.</span><span class="hl-6">abort</span><span class="hl-1">(); </span><span class="hl-7">// will abort ALL pending promises from both instances</span>
</code><button type="button">Copy</button></pre>

<p>A clone that will time out after a specified amount of time can be created using the <code>&lt;tool&gt;._withTimeout()</code> function.</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Adb</span><span class="hl-1">, </span><span class="hl-2">HierarchicalAbortController</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;promise-android-tools&quot;</span><span class="hl-1">;</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">adb</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Adb</span><span class="hl-1">();</span><br/><span class="hl-2">adb</span><span class="hl-1">.</span><span class="hl-6">_withTimeout</span><span class="hl-1">(</span><span class="hl-9">1000</span><span class="hl-1">).</span><span class="hl-6">wait</span><span class="hl-1">(); </span><span class="hl-7">// will resolve if a device is detected or automatically reject after the timeout of one second</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">controller</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">HierarchicalAbortController</span><span class="hl-1">();</span><br/><span class="hl-2">adb</span><span class="hl-1">.</span><span class="hl-6">_withSignals</span><span class="hl-1">(</span><span class="hl-2">controller</span><span class="hl-1">.</span><span class="hl-2">signal</span><span class="hl-1">).</span><span class="hl-6">wait</span><span class="hl-1">(); </span><span class="hl-7">// will be pending until aborted</span><br/><span class="hl-2">controller</span><span class="hl-1">.</span><span class="hl-6">abort</span><span class="hl-1">(); </span><span class="hl-7">// will abort only this promise, not the instance overall</span>
</code><button type="button">Copy</button></pre>

<h3 id="log-execution-events" class="tsd-anchor-link">Log execution events<a href="#log-execution-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Events are available to log or introspect tool executions.</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">DeviceTools</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;promise-android-tools&quot;</span><span class="hl-1">;</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">dt</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">DeviceTools</span><span class="hl-1">();</span><br/><br/><span class="hl-2">dt</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-3">&quot;exec&quot;</span><span class="hl-1">, </span><span class="hl-2">r</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&quot;exec&quot;</span><span class="hl-1">, </span><span class="hl-2">r</span><span class="hl-1">));</span><br/><span class="hl-2">dt</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-3">&quot;spawn:start&quot;</span><span class="hl-1">, </span><span class="hl-2">r</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&quot;spawn:start&quot;</span><span class="hl-1">, </span><span class="hl-2">r</span><span class="hl-1">));</span><br/><span class="hl-2">dt</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-3">&quot;spawn:exit&quot;</span><span class="hl-1">, </span><span class="hl-2">r</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&quot;spawn:exit&quot;</span><span class="hl-1">, </span><span class="hl-2">r</span><span class="hl-1">));</span><br/><span class="hl-2">dt</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-3">&quot;spawn:error&quot;</span><span class="hl-1">, </span><span class="hl-2">r</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&quot;spawn:error&quot;</span><span class="hl-1">, </span><span class="hl-2">r</span><span class="hl-1">));</span><br/><br/><span class="hl-2">dt</span><span class="hl-1">.</span><span class="hl-2">adb</span><span class="hl-1">.</span><span class="hl-6">shell</span><span class="hl-1">(</span><span class="hl-3">&quot;echo&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;test&quot;</span><span class="hl-1">);</span><br/><span class="hl-7">// will log a compact object (i.e. no falsy values) consisting of the command array cmd, the error object, and the stderr and stdout buffers. The path to the executable will be replaced with the tool name for brevity:</span><br/><span class="hl-7">// exec {</span><br/><span class="hl-7">//   cmd: [ &#39;adb&#39;, &#39;-P&#39;, 5037, &#39;shell&#39;, &#39;echo test&#39; ],</span><br/><span class="hl-7">//   error: {</span><br/><span class="hl-7">//     message: &#39;Command failed: adb -P 5037 shell echo test\n&#39; +</span><br/><span class="hl-7">//       &#39;adb: no devices/emulators found&#39;,</span><br/><span class="hl-7">//     code: 1</span><br/><span class="hl-7">//   },</span><br/><span class="hl-7">//   stderr: &#39;adb: no devices/emulators found&#39;</span><br/><span class="hl-7">// }</span>
</code><button type="button">Copy</button></pre>

<h3 id="complex-example" class="tsd-anchor-link">Complex example<a href="#complex-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The library provides most features of the eponymous command-line utilities wrapped in the available classes. This example only serves as a demonstration - please consult the documenation to discover the full power of this library.</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">DeviceTools</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;promise-android-tools&quot;</span><span class="hl-1">;</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">dt</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">DeviceTools</span><span class="hl-1">();</span><br/><br/><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-2">adb</span><br/><span class="hl-1">  .</span><span class="hl-6">wait</span><span class="hl-1">() </span><span class="hl-7">// wait for any device over adb</span><br/><span class="hl-1">  .</span><span class="hl-6">then</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">dt</span><span class="hl-1">.</span><span class="hl-2">adb</span><span class="hl-1">.</span><span class="hl-6">ensureState</span><span class="hl-1">(</span><span class="hl-3">&quot;recovery&quot;</span><span class="hl-1">)) </span><span class="hl-7">// reboot to recovery if we have to</span><br/><span class="hl-1">  .</span><span class="hl-6">then</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">dt</span><span class="hl-1">.</span><span class="hl-2">adb</span><span class="hl-1">.</span><span class="hl-6">push</span><span class="hl-1">([</span><span class="hl-3">&quot;./config.json&quot;</span><span class="hl-1">], </span><span class="hl-3">&quot;/tmp&quot;</span><span class="hl-1">, </span><span class="hl-2">progress</span><span class="hl-1">)) </span><span class="hl-7">// push a config file to the device</span><br/><span class="hl-1">  .</span><span class="hl-6">then</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">dt</span><span class="hl-1">.</span><span class="hl-2">adb</span><span class="hl-1">.</span><span class="hl-6">getDeviceName</span><span class="hl-1">()) </span><span class="hl-7">// read device codename</span><br/><span class="hl-1">  .</span><span class="hl-6">then</span><span class="hl-1">(</span><span class="hl-2">name</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// samsung devices do not use fastbooot</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">name</span><span class="hl-1">.</span><span class="hl-6">includes</span><span class="hl-1">(</span><span class="hl-3">&quot;samsung&quot;</span><span class="hl-1">)) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">dt</span><span class="hl-1">.</span><span class="hl-2">adb</span><br/><span class="hl-1">        .</span><span class="hl-6">reboot</span><span class="hl-1">(</span><span class="hl-3">&quot;bootloader&quot;</span><span class="hl-1">) </span><span class="hl-7">// reboot to samsung&#39;s download mode</span><br/><span class="hl-1">        .</span><span class="hl-6">then</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">dt</span><span class="hl-1">.</span><span class="hl-2">heimdall</span><span class="hl-1">.</span><span class="hl-6">wait</span><span class="hl-1">()) </span><span class="hl-7">// wait for device to respond to heimdall</span><br/><span class="hl-1">        .</span><span class="hl-6">then</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">dt</span><span class="hl-1">.</span><span class="hl-2">heimdall</span><span class="hl-1">.</span><span class="hl-6">flash</span><span class="hl-1">(</span><span class="hl-3">&quot;boot&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;boot.img&quot;</span><span class="hl-1">)) </span><span class="hl-7">// flash an image to a partition</span><br/><span class="hl-1">        .</span><span class="hl-6">then</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">dt</span><span class="hl-1">.</span><span class="hl-2">heimdall</span><span class="hl-1">.</span><span class="hl-6">reboot</span><span class="hl-1">()); </span><span class="hl-7">// reboot to system</span><br/><span class="hl-1">    } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">dt</span><span class="hl-1">.</span><span class="hl-2">adb</span><br/><span class="hl-1">        .</span><span class="hl-6">reboot</span><span class="hl-1">(</span><span class="hl-3">&quot;bootloader&quot;</span><span class="hl-1">) </span><span class="hl-7">// reboot to bootloader (aka. fastboot mode)</span><br/><span class="hl-1">        .</span><span class="hl-6">then</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">dt</span><span class="hl-1">.</span><span class="hl-2">fastboot</span><span class="hl-1">.</span><span class="hl-6">wait</span><span class="hl-1">()) </span><span class="hl-7">// wait for device to respond to fastboot commands</span><br/><span class="hl-1">        .</span><span class="hl-6">then</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">dt</span><span class="hl-1">.</span><span class="hl-2">fastboot</span><span class="hl-1">.</span><span class="hl-6">flash</span><span class="hl-1">(</span><span class="hl-3">&quot;boot&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;boot.img&quot;</span><span class="hl-1">)) </span><span class="hl-7">// flash an image</span><br/><span class="hl-1">        .</span><span class="hl-6">then</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">dt</span><span class="hl-1">.</span><span class="hl-2">fastboot</span><span class="hl-1">.</span><span class="hl-6">continue</span><span class="hl-1">()); </span><span class="hl-7">// auto-boot to system</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">  .</span><span class="hl-6">then</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">dt</span><span class="hl-1">.</span><span class="hl-2">adb</span><span class="hl-1">.</span><span class="hl-6">wait</span><span class="hl-1">(</span><span class="hl-3">&quot;device&quot;</span><span class="hl-1">)) </span><span class="hl-7">// ignore devices in recovery or a different mode</span><br/><span class="hl-1">  .</span><span class="hl-6">then</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&quot;flashing complete, that was easy!&quot;</span><span class="hl-1">)); </span><span class="hl-7">// yay</span><br/><br/><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-6">progress</span><span class="hl-1">(</span><span class="hl-2">p</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&quot;operation&quot;</span><span class="hl-1">, </span><span class="hl-2">p</span><span class="hl-1"> * </span><span class="hl-9">100</span><span class="hl-1">, </span><span class="hl-3">&quot;% complete&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h3 id="documentation" class="tsd-anchor-link">Documentation<a href="#documentation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Typescript types are bundled and IntelliSense is supported. Run <code>npm run docs</code> to build html from JSdoc/Typedoc comments for all methods and types.</p>
<h2 id="api-changes-deprecation-notices-upgrade-guide" class="tsd-anchor-link">API Changes, Deprecation Notices, Upgrade Guide<a href="#api-changes-deprecation-notices-upgrade-guide" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="upgrading-to-6x" class="tsd-anchor-link">Upgrading to 6.x<a href="#upgrading-to-6x" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Version 6.0.0 required Node v20 and above and has also dropped the dependency on <code>android-tools-bin</code>, as the dependency got added to this package instead to reduce maintanance burden.</p>
<h3 id="upgrading-to-5x" class="tsd-anchor-link">Upgrading to 5.x<a href="#upgrading-to-5x" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>For version 5.0.0, the library has been migrated to typescript for increased stability and type safety. Many under-the-hood components have been redesigned for more efficient abstraction and ease of use.</p>
<ul>
<li>CancelablePromise has been replaced by the the native <a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController">AbortController</a> interface. The <code>&lt;tool&gt;.kill()</code> method has been renamed to <code>&lt;tool&gt;.abort()</code>.</li>
<li>Error handling has been restructured. Tools now throw <code>AdbError</code>, <code>FastbootError</code>, or <code>HeimdallError</code> objects implementing the <code>ToolError</code> interface and providing the original unaltered error in the <code>cause</code> property. Current standardized error messages include <code>&quot;aborted&quot; | &quot;no device&quot; | &quot;more than one device&quot; | &quot;unauthorized&quot; | &quot;device offline&quot; | &quot;bootloader locked&quot; | &quot;enable unlocking&quot; | &quot;low battery&quot; | &quot;failed to boot&quot;</code>.</li>
<li>Dependencies have been re-evaluated and many external libraries have been replaced with more solid solutions from modern NodeJS built-ins.</li>
<li>Global command-line options for tools are now configurable on the <code>&lt;tool&gt;.config</code> property.</li>
<li>The execOptions parameter has been removed in favor of <code>extraArgs</code> and <code>extraEnv</code> properties and their respective helper functions.</li>
</ul>
<h3 id="upgrading-to-4x" class="tsd-anchor-link">Upgrading to 4.x<a href="#upgrading-to-4x" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Version 4.0.0 includes a major re-factoring effort that touched almost every function. The APIs of most functions remained intact, but in most cases you will have to make changes to your code. This has been done to correct some early design decisions.</p>
<ul>
<li>A new convenience class <code>DeviceTools</code> has been implemented that provides instances of all tool classes as well as some generic convenience functions such as <code>deviceTools.wait()</code> (wait for any device to be visible with any adb, fastboot, or heimdall) and <code>deviceTools.getDeviceName()</code> (read the device name from fastboot or adb). In most cases you will no longer need to instantiate any of the tool classes directly.</li>
<li>In order to properly follow the object-oriented paradigm, all tool wrapper classes now inherit from a new <code>Tool</code> class that implements the <code>child_process</code> wrappers along with some common interfaces. The implications of this are:
<ul>
<li>Our <a href="https://www.npmjs.com/package/android-tools-bin">android-tools-bin</a> package is now included as a dependency. If you require custom executables, you can use <a href="https://www.npmjs.com/package/android-tools-bin#requesting-native-tools-using-environment-variables">environment variables</a>.</li>
<li>Specifying a custom <code>exec</code> function in the constructor arguments is no longer supported.
<ul>
<li>We no longer use <code>child_process.exec</code> to avoid spawining a shell. Confer with the <a href="https://nodejs.org/api/child_process.html">official documentation</a> to learn what this entails in detail. Most short-lived commands now use <code>child_process.execFile</code>. Long-running commands use</li>
</ul>
</li>
<li>Specifying a custom <code>log</code> function in the constructor arguments is no longer supported. You can instead listen to the events <code>exec</code>, <code>spawn:start</code>, <code>spawn:exit</code>, and <code>spawn:error</code> on the tool object to implement your own logging or introspection logic.</li>
<li>The <code>&lt;tool&gt;.&lt;tool&gt;Event</code> event emitter has been deprecated. Instead, the tool class now inherits from the event emitter class directly.</li>
</ul>
</li>
<li><code>&lt;tool&gt;.waitForDevice()</code> and <code>&lt;tool&gt;.stopWaiting()</code> have been deprecated in favor of <code>&lt;tool&gt;.wait()</code>.
<ul>
<li>On <code>fastboot</code> and <code>heimdall</code>, <code>&lt;tool&gt;.wait()</code> will poll using <code>&lt;tool&gt;.hasAccess()</code> at a fixed interval. It does not take arguments.</li>
<li><code>adb.wait()</code> uses the <code>adb wait-for-[-TRANSPORT]-STATE</code> command instead. You can optionally specify the state or transport as arguments, eg <code>adb.wait(&quot;recovery&quot;, &quot;usb&quot;)</code>.</li>
<li>The <code>&lt;tool&gt;.wait()</code> function returns a <a href="https://github.com/alkemics/CancelablePromise">CancelablePromise</a>, which extends the native ES promise to support cancelling pending promises. Calling <code>const p = adb.wait(); setTimeout(() =&gt; p.cancel(), 5000);</code> will kill the waiting child-process and settle the pending promise.</li>
</ul>
</li>
<li><code>adb.pushArray()</code> has been deprecated and incorporated into the <code>adb.push()</code> API.
<ul>
<li>Since the <code>adb push</code> command supports pushing multiple files to the same location and this is the most common usecase, the <code>adb.pushArray()</code> function has been deprecated. The <code>adb.push()</code> function now takes an array of source file paths, a target destination path on the device, and a progress callback.</li>
<li>The progress is now reported on-the-fly and no longer requires polling via <code>adb shell stat &lt;file&gt;</code>. This results in faster and more accurate reporting.</li>
</ul>
</li>
<li>Functions that are considered unstable or experimental have been makred as such in their documentation comments. If you're building a product around any of those, you're welcome to help us improve the library to ensure your needs will be accounted for in the future.</li>
</ul>
<h3 id="upgrading-to-3x" class="tsd-anchor-link">Upgrading to 3.x<a href="#upgrading-to-3x" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Version 3.0.0 introduced a breaking API change in <code>fastboot.flash()</code> and <code>fastboot.flashRaw()</code>. Pervious the third and fourth arguments of <code>fastboot.flash()</code> were boolean arguments for indicating force and raw flashing. Similarly <code>fastboot.flashRaw()</code> is a convenience function that forwarded the third argument as a boolean flag for the force option. The new API of <code>fastboot.flash()</code> accepts a boolean value for raw flashing as the third argument, followed by any number of string arguments for additional flags. The <code>fastboot.flashRaw()</code> function similarly accepts any number of arguments for additional flags starting at the third argument. The <code>fastboot.flashArray()</code> function now takes an array like <code>[ {partition, file, raw, flags}, ... ]</code> as an argument. We believe that this change is more in line with the latest developments in the fastboot cli and provides better access to options like <code>--force</code>, <code>--disable-verity</code>, and <code>--disable-verification</code>.</li>
<li>NodeJS version 8 and below have been deprecated and are no longer supported. Versions 10, 12, and 14 are actively tested and supported.</li>
<li>New experimental backup and restore functions for use with Ubuntu Touch have been added to the ADB module. The API of these might change in the future.</li>
</ul>
<h3 id="upgrading-to-2x" class="tsd-anchor-link">Upgrading to 2.x<a href="#upgrading-to-2x" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>No breaking API changes were introduced in version 2.0.0.</li>
<li>A new <code>Heimdall</code> module provides access to Samsung devices.</li>
</ul>
<h2 id="license" class="tsd-anchor-link">License<a href="#license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Original development by <a href="https://spri.nz">Johannah Sprinz</a> and <a href="http://mariogrip.com/">Marius Gripsgård</a>. Copyright (C) 2017-2022 <a href="https://ubports.com">UBports Foundation</a>.</p>
<p>This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</p>
<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License along with this program. If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#promise-android-tools"><span>promise-<wbr/>android-<wbr/>tools</span></a><ul><li><a href="#usage"><span>Usage</span></a></li><li><ul><li><a href="#quick-start-example"><span>Quick-<wbr/>start example</span></a></li><li><a href="#config-env-vars"><span>Config, <wbr/>Env vars</span></a></li><li><a href="#aborting-pending-promises"><span>Aborting pending <wbr/>Promises</span></a></li><li><a href="#log-execution-events"><span>Log execution events</span></a></li><li><a href="#complex-example"><span>Complex example</span></a></li><li><a href="#documentation"><span>Documentation</span></a></li></ul></li><li><a href="#api-changes-deprecation-notices-upgrade-guide"><span>API <wbr/>Changes, <wbr/>Deprecation <wbr/>Notices, <wbr/>Upgrade <wbr/>Guide</span></a></li><li><ul><li><a href="#upgrading-to-6x"><span>Upgrading to 6.x</span></a></li><li><a href="#upgrading-to-5x"><span>Upgrading to 5.x</span></a></li><li><a href="#upgrading-to-4x"><span>Upgrading to 4.x</span></a></li><li><a href="#upgrading-to-3x"><span>Upgrading to 3.x</span></a></li><li><a href="#upgrading-to-2x"><span>Upgrading to 2.x</span></a></li></ul></li><li><a href="#license"><span>License</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">promise-android-tools</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
